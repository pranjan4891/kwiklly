<footer class="footer-section extramarginfooter" >
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="row">
                      <!-- Logo & Social Links -->
                        <div class="col-md-12">
                            <div class="footer-logo">
                                <img src="{{ asset('public/assets/website/images/logo.png')}}" alt="Kwikly Logo">
                            </div>
                            <div class="footer-social">
                                <a href="#"><i class="fab fa-linkedin"></i></a>
                                <a href="#"><i class="fab fa-facebook"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                                <a href="#"><img src="{{ asset('public/assets/website/images/logotwiter.png')}}" alt="" style="height: 22px;
                                margin-bottom: 5px;"></a>
                            </div>
                        </div>
                    </div>
              </div>
              <div class="col-md-8">
                <div class="row categorypadding">
                    <div class="col-md-4 col-6 footer-links">
                        <h5>Resources</h5>
                        <ul>
                            <li><a href="{{route('myaccount')}}">My Account</a></li>
                            <li><a href="{{route('vendor.signup')}}">Vendor Registration</a></li>
                        </ul>
                    </div>

                    <!-- Company -->
                    <div class="col-md-4 col-6 footer-links">
                        <h5>Company</h5>
                        <ul>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms & Condition</a></li>
                            <li><a href="#">Return Policy</a></li>
                        </ul>
                    </div>

                    <!-- About -->
                    <div class="col-md-4 col-12 footer-links">
                        <h5>About</h5>
                        <ul>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Contact Us</a></li>
                        </ul>
                    </div>
                    </div>
                    <hr class="breakdown">
                    <div class="row mt-4 footer-links hidecat">
                      <h5>Category</h5>
                        <div class="col-md-4 col-6  footer-links">
                            <ul>
                                <li><a href="#">Dry Fruit</a></li>
                                <li><a href="#">Bakery</a></li>
                                <li><a href="#">Masala</a></li>
                            </ul>
                        </div>

                        <!-- Company -->
                        <div class="col-md-4 col-6 footer-links">
                            <ul>
                                <li><a href="#">Meat & Sea Food</a></li>
                                <li><a href="#">Biscuit & Cake</a></li>
                                <li><a href="#">Atta Rice & Dal</a></li>
                            </ul>
                        </div>

                    <!-- About -->
                    <div class="col-md-4 col-12 footer-links">
                        <ul>
                            <li><a href="#">Oil & Ghee</a></li>
                            <li><a href="#">Creals & Breakfast </a></li>
                            <select class="shopmore" style="background-color: transparent;padding: 5px 10px; border:1px solid #D8C2BC;">
                                <option>Show More</option>
                                <option>Cake </option>
                                <option>Masala</option>
                            </select>

                        </ul>
                            <!-- mobile shop more  -->
                    <div class="text-center py-3 shopmore2">
                        <select style="background-color: transparent;padding: 5px 10px; border:1px solid #D8C2BC;">
                            <option>Show More</option>
                            <option>Cake </option>
                            <option>Masala</option>
                        </select>
                    </div>
                        <hr class="breakdown">
                    </div>
                </div>
              </div>
        </div>
        <section>
            <div class="container p-0">
            <div class="row paymentspacing">
                        <!-- Payment Options -->
                        <div class="col-md-8 footer-links ">
                            <h5>We accept payment by</h5>
                            <div class="footer-payments mt-3">
                                <img src="{{ asset('public/assets/website/images/payment1.png')}}" alt="Paytm">
                                <img src="{{ asset('public/assets/website/images/payment2.png')}}" alt="RuPay">
                                <img src="{{ asset('public/assets/website/images/payment3.png')}}" alt="Visa">
                                <img src="{{ asset('public/assets/website/images/payment4.png')}}" alt="Mastercard">
                                <img src="{{ asset('public/assets/website/images/payment5.png')}}" alt="American Express">
                            </div>
                            <div class="footer-payments ">
                                <img src="{{ asset('public/assets/website/images/payment6.png')}}" alt="Paytm">
                                <img src="{{ asset('public/assets/website/images/payment7.png')}}" alt="RuPay">
                                <img src="{{ asset('public/assets/website/images/payment8.png')}}" alt="Visa">
                                <img src="{{ asset('public/assets/website/images/payment9.png')}}" alt="Mastercard">
                                <img src="{{ asset('public/assets/website/images/payment10.png')}}" alt="American Express">
                            </div>
                        </div>

                        <!-- Subscription Section -->
                        <div class="col-md-4 extrafootermargin">
                            <h5 class="py-2 textnewsletter">Get offers, discount codes and deals from Kwikly</h5>
                            <div class="footer-subscribe newformcontrol position-relative">
                                <input type="email" class="form-control" placeholder="Your Email">
                                <button class="btn btn-subscribe">Subscribe</button>
                            </div>
                        </div>
                    </div>
                <hr>
            <div class="footer-bottom ">
                Copyright &copy; 2000 - 2025 Kwikly. All rights reserved.
            </div>
            </div>
        </section>
    </footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<!--------------- CUSTOM JAVASCRIPT START ----------------->
    <script src="{{ asset('public/assets/website/JS/custom.js')}}"></script>
    <!--------------- CUSTOM JAVASCRIPT END ----------------->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<!-- ==================== JAVASCRIPT SECTION ==================== -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Modal Functions
    function showModal() { document.getElementById('couponModalxyz').style.display = 'flex'; }
    function hideModal() { document.getElementById('couponModalxyz').style.display = 'none'; }

    // Address Form Handling
    document.addEventListener("DOMContentLoaded", function () {
        const homeBtn = document.getElementById("pataHomeBtn");
        const workBtn = document.getElementById("pataWorkBtn");
        const addressType = document.getElementById("addressType");

        homeBtn.addEventListener("click", function () {
            homeBtn.classList.add("active");
            workBtn.classList.remove("active");
            addressType.value = "home";
        });

        workBtn.addEventListener("click", function () {
            workBtn.classList.add("active");
            homeBtn.classList.remove("active");
            addressType.value = "work";
        });

        document.getElementById('addressForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch("{{ route('address.store') }}", {
                method: 'POST',
                headers: { 'X-CSRF-TOKEN': '{{ csrf_token() }}' },
                body: formData
            })
            .then(res => res.ok ? res.json() : res.text().then(text => { throw new Error(text) }))
            .then(data => {
                alert(data.message);
                closePataSidebar();
                openSidebar();
            })
            .catch(err => {
                console.error('Submission error:', err);
                alert('Something went wrong!');
            });
        });
    });

    // Cart Functions
    function openCart() {
        document.getElementById("cartSidebar").classList.add("show");
        document.getElementById("overlay").classList.add("active");
    }
    function closeCart() {
        document.getElementById("cartSidebar").classList.remove("show");
        document.getElementById("overlay").classList.remove("active");
    }



    // Google Maps API Key (replace with yours)
   // const GOOGLE_MAPS_API_KEY = "{{ env('GOOGLE_MAPS_API_KEY') }}";

    // On DOM ready
    // window.onload = function () {
    //     const popup = document.getElementById("addpopPopup");
    //     const overlay = document.getElementById("addpopOverlay");
    //     const locationText = document.getElementById("currentLocation");
    //     const trigger = document.querySelector(".location-box");

    //     // Fetch and set current location
    //     function fetchAndSetLocation() {
    //         if (navigator.geolocation) {
    //             navigator.geolocation.getCurrentPosition(async (position) => {
    //                 const lat = position.coords.latitude;
    //                 const lng = position.coords.longitude;

    //                 try {
    //                     const response = await fetch(
    //                         `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=${GOOGLE_MAPS_API_KEY}`
    //                     );
    //                     const data = await response.json();

    //                     if (data.status === "OK" && data.results.length > 0) {
    //                         const address = data.results[0].formatted_address;
    //                         locationText.innerHTML = `Current Location <br>${address}`;
    //                     } else {
    //                         locationText.innerHTML = "Unable to fetch address";
    //                     }
    //                 } catch (error) {
    //                     locationText.innerHTML = "Error fetching location";
    //                     console.error(error);
    //                 }
    //             }, () => {
    //                 locationText.innerHTML = "Permission denied";
    //             });
    //         } else {
    //             locationText.innerHTML = "Geolocation not supported";
    //         }
    //     }

        // Call location fetch on load
       // fetchAndSetLocation();

        // Location popup toggle
        function toggleAddpop(e) {
            e.stopPropagation();
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                popup.classList.add("addpop-mobile-active");
            } else {
                const rect = trigger.getBoundingClientRect();
                popup.style.left = rect.left + "px";
                popup.style.top = rect.bottom + window.scrollY + "px";
                popup.classList.add("addpop-desktop-active");
                overlay.classList.add("addpop-visible");
            }

            document.body.style.overflow = 'hidden';
        }

        // Close popup
        function closeAddpop() {
            popup.classList.remove("addpop-mobile-active", "addpop-desktop-active");
            overlay.classList.remove("addpop-visible");
            document.body.style.overflow = 'auto';
        }

        // Make globally accessible (for inline HTML `onclick`)
        window.toggleAddpop = toggleAddpop;
        window.closeAddpop = closeAddpop;
    };



    // Address Sidebar Functions
    function openSidebar() {
        document.getElementById("addressSidebar").classList.add("open");
        fetch("{{ route('address.list') }}", {
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRF-TOKEN': '{{ csrf_token() }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            const container = document.querySelector(".address-section");
            container.innerHTML = `<div class="section-title">Your Saved Address</div>`;

            if (data.length === 0) {
                container.innerHTML += `<p class="text-muted">No address found.</p>`;
                return;
            }

            data.forEach(item => {
                const icon = item.type === 'home'
                    ? 'https://cdn-icons-png.flaticon.com/128/69/69524.png'
                    : 'https://cdn-icons-png.flaticon.com/128/609/609803.png';

                container.innerHTML += `
                <div class="address-card" onclick='selectAddress(this)'
                    data-address="${item.flat}, ${item.area}, ${item.landmark ?? ''}, ${item.pincode}"
                    data-name="${item.name}">
                    <div class="address-left">
                        <img src="${icon}" alt="${item.type}" class="icon">
                        <div>
                            <strong>${capitalize(item.type)}</strong>
                            <p>${item.name}, ${item.flat}, ${item.area}, ${item.landmark ?? ''}, ${item.pincode}</p>
                        </div>
                    </div>
                    <div class="address-right">
                        <span class="check">&#x2714;</span>
                        <div class="dropdown-wrapper">
                            <span class="options" onclick="toggleDropdown(this)">&#8942;</span>
                            <div class="dropdown-menu">
                                <div onclick="editAddress(${item.id})">Edit</div>
                                <div onclick="deleteAddress(${item.id})">Delete</div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
        })
        .catch(err => console.error("Error loading addresses:", err));
    }

    $('.cartItemsWrapper').html(html);

    function selectAddress(el) {
        document.querySelectorAll(".address-card").forEach(card => card.classList.remove("selected"));
        el.classList.add("selected");
        const address = el.getAttribute("data-address");
        const name = el.getAttribute("data-name");
        document.getElementById("selectedAddressText").innerText = `${name}, ${address}`;
        sessionStorage.setItem("selectedAddress", JSON.stringify({ name, address }));
        closeSidebar();
    }

    function capitalize(str) { return str.charAt(0).toUpperCase() + str.slice(1); }

    // Cart AJAX Handling
    $(document).ready(function () {
        // Initial cart load
        $.get("{{ route('cart.data') }}", function (res) {
            $('#cart-count').text(res.count);
            loadSideCartItems(res.cart);
        });

        // ADD to cart
        $(document).on('click', '.add-btn', function () {
            let productId = $(this).data('product-id');
            let variantId = $(this).data('variant-id');
            if (!variantId) return;

    $('.billSummary').html(`
        <ul class="list-unstyled small">
          <li class="d-flex justify-content-between">
            <span>Item charge</span><span>₹${total}</span>
          </li>
          <li class="d-flex justify-content-between">
            <span>Delivery Charges</span><span>₹${deliveryCharge}</span>
          </li>
          <li class="d-flex justify-content-between">
            <span>Coupon Discount</span><span class="text-success">- ₹${couponDiscount}</span>
          </li>
          <li class="d-flex justify-content-between">
            <span>Wallet Discount</span><span class="text-success">- ₹${walletDiscount}</span>
          </li>
        </ul>
    `);

            $.ajax({
                url: "{{ route('cart.add') }}",
                type: "POST",
                data: {
                    _token: "{{ csrf_token() }}",
                    product_id: productId,
                    variant_id: variantId,
                    quantity: 1
                },
                success: function (res) {
                    $('#cart-count').text(res.count);
                    loadSideCartItems(res.cart);
                    let qtyContainer = `
                        <div class="qty-container">
                            <button class="qty-btn minus decrement-btn" data-key="${key}">−</button>
                            <input type="text" class="qty-input quantity-input" value="1" readonly>
                            <button class="qty-btn plus increment-btn" data-key="${key}">+</button>
                        </div>
                    `;
                    parent.html(qtyContainer);
                    openCart();
                }
            });
        });

        // INCREMENT quantity
        $(document).on('click', '.increment-btn', function () {
            let key = $(this).data('key');
            $.post("{{ route('cart.increment') }}", {
                _token: "{{ csrf_token() }}",
                key: key
            }, function (res) {
                $('#cart-count').text(res.count);
                loadSideCartItems(res.cart);
                let updatedQty = null;
                $.each(res.cart, function (businessName, items) {
                    if (items[key]) updatedQty = items[key].quantity;
                });
                if (updatedQty !== null) {
                    $(`[data-key="${key}"]`).find('.quantity-input').val(updatedQty);
                }
            });
        });

        // DECREMENT quantity
        $(document).on('click', '.decrement-btn', function () {
            let key = $(this).data('key');
            $.post("{{ route('cart.decrement') }}", {
                _token: "{{ csrf_token() }}",
                key: key
            }, function (res) {
                $('#cart-count').text(res.count);
                loadSideCartItems(res.cart);
                let productId = key.split('_')[0];
                let variantId = key.split('_')[1];
                let productQtyBox = $(`.qty-box[data-product-id="${productId}"][data-variant-id="${variantId}"]`);

                if (!res.cart || !Object.values(res.cart).some(group => group[key])) {
                    productQtyBox.html(`
                        <button class="add-btn" data-product-id="${productId}" data-variant-id="${variantId}">
                            Add
                            <img src="{{ asset('public/assets/website/images/cart.svg') }}" class="ms-2">
                        </button>
                    `);
                } else {
                    $(`[data-key="${key}"] .quantity-input`).val(
                        Object.values(res.cart).find(group => group[key])[key].quantity
                    );
                }
            });
        });

        // Proceed to Checkout
        $('.proceed-btn').on('click', function () {
            $.ajax({
                url: "{{ route('check.auth.status') }}",
                method: "GET",
                success: function (res) {
                    if (res.logged_in) {
                        window.location.href = "{{ route('checkout.page') }}";
                    } else {
                        window.location.href = "{{ route('login') }}";
                    }
                }
            });
        });
    });

    // Render cart items in sidebar
    function loadSideCartItems(cartGroups) {
        let html = '';
        let total = 0;

        if (cartGroups && Object.keys(cartGroups).length > 0) {
            $.each(cartGroups, function (businessName, items) {
                html += `<div class="cart-business-group mb-3">
                    <h6 class="mb-1">${businessName}</h6>
                    <a href="#" class="small text-primary mb-2 d-block">Go to store</a>
                `;

                $.each(items, function (key, item) {
                    let price = parseFloat(item.price);
                    let quantity = parseInt(item.quantity);
                    let originalPrice = item.original_price || price;
                    let subtotal = price * quantity;
                    total += subtotal;

                    html += `
                        <div class="cart-item d-flex align-items-center justify-content-between border-bottom py-2 p-3">
                            <div class="d-flex align-items-center totalimg">
                                <img src="${item.image}" alt="${item.title}" style="width:50px;">
                                <div class="mx-3">
                                    <p class="mb-0">${item.title}</p>
                                    <small class="text-success">
                                        ₹${price} ${price < originalPrice ? `<s class="text-muted">₹${originalPrice}</s>` : ''}
                                    </small>
                                </div>
                            </div>
                            <div class="input-group input-group-sm sidecartbutton" style="width: 90px;">
                                <button class="btn btn-danger decrement-btn" data-key="${key}">-</button>
                                <input type="text" class="form-control text-center quantity-input" value="${quantity}" disabled>
                                <button class="btn btn-danger increment-btn" data-key="${key}">+</button>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            });
        } else {
            html = `<p class="text-center">Your cart is empty.</p>`;
        }

        $('#cartItemsWrapper').html(html);
        updateBillSummary(total);
    }

    function updateBillSummary(total) {
        let deliveryCharge = 0;
        let couponDiscount = 0;
        let walletDiscount = 0;
        let grandTotal = total + deliveryCharge - couponDiscount - walletDiscount;

        $('#billSummary').html(`
            <ul class="list-unstyled small">
              <li class="d-flex justify-content-between">
                <span>Item charge</span><span>₹${total}</span>
              </li>
              <li class="d-flex justify-content-between">
                <span>Delivery Charges</span><span>₹${deliveryCharge}</span>
              </li>
              <li class="d-flex justify-content-between">
                <span>Coupon Discount</span><span class="text-success">- ₹${couponDiscount}</span>
              </li>
              <li class="d-flex justify-content-between">
                <span>Wallet Discount</span><span class="text-success">- ₹${walletDiscount}</span>
              </li>
            </ul>
        `);

        $('.proceed-btn').html(`Proceed to Pay ₹${grandTotal}`);
        $('.grand-total-box strong').html(`₹${grandTotal}`);
    }
</script>
</body>
</html>
